<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keystroke Dynamics Collector</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Modal de consentement RGPD -->
  <div id="consent-modal" class="modal hidden">
    <div class="modal-content">
      <h2>Consentement à la collecte de données</h2>
      <p>Cette application collecte uniquement des données anonymes sur votre comportement de frappe (dynamique de frappe).<br>
      <strong>Aucune information personnelle n'est enregistrée. La caméra ne sera utilisée que si vous activez le mode caméra.</strong><br>
      Les données collectées incluent :
        <ul>
          <li>Horodatages des touches pressées et relâchées</li>
          <li>Durées de maintien et intervalles entre frappes</li>
          <li>Détection d'émotions via caméra (uniquement en mode caméra)</li>
          <li>Informations techniques sur l'appareil (navigateur, OS, taille écran)</li>
        </ul>
      Elles sont stockées de façon sécurisée sur le serveur et ne sont accessibles qu'aux administrateurs de l'application.<br>
      Ces données ne servent qu'à des fins de recherche comportementale et ne sont pas partagées avec des tiers.<br>
      En continuant, vous acceptez cette collecte anonyme.</p>
      <button id="accept-consent">J'accepte</button>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>Keystroke Dynamics Collector</h1>
      <p>Analyse your typing patterns under different contexts</p>
    </header>

    <main>
      <div class="options">
        <div class="option-card" id="manual-option">
          <h2>Free Typing</h2>
          <p>Type freely to record your keystroke dynamics</p>
        </div>
        
        <div class="option-card" id="music-option">
          <h2>Music Context Typing</h2>
          <p>Type while listening to different music styles</p>
        </div>
        
        <div class="option-card" id="webcam-option">
          <h2>Camera Context Typing</h2>
          <p>Type with visible camera feed to correlate visual context</p>
          <span class="badge">With emotion detection</span>
        </div>
      </div>
    </main>

    <section id="manual-tracking" class="tracking-section hidden">
      <button class="back-button">← Back</button>
      <h2>Free Typing - Keystroke Collection</h2>
      <div class="keystroke-info">
        <p>This session will record:</p>
        <ul>
          <li>Key press times</li>
          <li>Key release times</li>
          <li>Press-to-release durations</li>
          <li>Release-to-release intervals</li>
        </ul>
      </div>
      <textarea id="typing-area" placeholder="Start typing here to record your keystroke dynamics..."></textarea>
      <div class="typing-metrics">
        <div id="typing-speed">Typing Speed: 0 CPM</div>
        <div id="keystroke-count">Keystrokes: 0</div>
      </div>
      <button id="save-manual" class="save-button">Save Data</button>
    </section>

    <section id="music-tracking" class="tracking-section hidden">
      <button class="back-button">← Back</button>
      <h2>Music Context Typing</h2>
      <div class="keystroke-info">
        <p>Type while different music styles play to analyze how music affects your typing patterns</p>
      </div>
      <div class="music-selection">
        <div class="music-item" data-music="happy">
          <p>Upbeat Music</p>
          <button class="play-button">Play</button>
        </div>
        <div class="music-item" data-music="sad">
          <p>Melancholic Music</p>
          <button class="play-button">Play</button>
        </div>
        <div class="music-item" data-music="energetic">
          <p>Energetic Music</p>
          <button class="play-button">Play</button>
        </div>
        <div class="music-item" data-music="calm">
          <p>Calm Music</p>
          <button class="play-button">Play</button>
        </div>
      </div>
      
      <div class="currently-playing">No music playing</div>
      
      <textarea id="music-typing-area" placeholder="Type here while listening to music..."></textarea>
      <div class="typing-metrics">
        <div id="music-typing-speed">Typing Speed: 0 CPM</div>
        <div id="music-keystroke-count">Keystrokes: 0</div>
      </div>
      <button id="save-music" class="save-button">Save Data</button>
    </section>

    <section id="webcam-tracking" class="tracking-section hidden">
      <button class="back-button">← Back</button>
      <h2>Camera Context Typing</h2>
      <div class="keystroke-info">
        <p>Type while camera is active. Your typing patterns will be recorded along with a video feed reference.</p>
        <p><em>This mode shows the camera feed and emotion detection statistics in real-time.</em></p>
      </div>
      <div class="webcam-container">
        <video id="webcam" autoplay muted></video>
        <p id="detection-status">Waiting for camera permission...</p>
      </div>
      <textarea id="webcam-typing-area" placeholder="Type here while camera is active..."></textarea>
      <div class="typing-metrics">
        <div id="webcam-typing-speed">Typing Speed: 0 CPM</div>
        <div id="webcam-keystroke-count">Keystrokes: 0</div>
      </div>
      <button id="save-webcam" class="save-button">Save Data</button>
    </section>

    <footer>
      <div class="privacy-note">
        <small>Data is stored securely on the server. <a href="#" id="privacy-link">Privacy Information</a></small>
      </div>
    </footer>
  </div>

  <!-- Using locally hosted face-api.js instead of CDN -->
  <script src="js/lib/face-api.min.js"></script>
  <script src="js/keystroke.js"></script>
  <script src="js/emotions.js"></script>
  <script src="js/webcam.js"></script>
  <script src="js/main.js"></script>
</body>
</html>